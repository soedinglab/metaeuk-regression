### test 1: recover a multi-exon protein ###

# the followong fake transcript has 4 exons - separated by "|": (330 nucs = 110 aas; 402 nucs = 134 aas; 180 nucs = 60 aas; 243 nucs = 81 aas)
ATGACTTTATGCGCAGGTTTTGACCCTAATCGATTTTTGCCCATCGTTCTCGACGTTGGCACCAACAATGAAACCCATCGTAAAAATCATCAATACATGGGTTTAAGAAAGGACCGTGTTCACGGTGAGCAGTATGACATCTTTTTGGAGAACGTTATTAAAGCCATTCGTGAAGTCTTTCCCGAGGCCTTTATTCACTTTGAGGATTTCGGACTTAAAAATGCCAAAAGGATTTTAGACCACTATCGTCCTAATATTGCCTGTTTTAACGATGATATCCAGGGCACCGGTGCTGTAGCACTGGCCGCCATTATAGGCGCCCTTCATGTT|ACGAAGTCTCCCTTAACCGAGCAGCGCATCATGATCTTTGGTGCTGGTACTGCTGGTGTTGGTATCGCCAACCAAATTGTCGCTGGTATGGTGACAGATGGCCTTTCATTAGGTAAGGCTAGAGATAATCTTTTCATGATTGATCGATGCGGTTTGCTTCTGGAGAGACATGCTAAGATTGCTACTGATGGACAAAAGCCATTTTTGAAGAAGGACTCAGACTTTAAGGAAGTCCCTTCTGGAGACATTGATTTAGAGACTGCTATTTCACTAATCAAACCCACTGTTCTTCTGGGGTGCTCCGGTCAACCTGGAAAATTTACAGAAAAGGCCATTCGTGAAATGAGCAAGCATGTCAAACATCCCATCATCTTCCCAATCTCTAACCCCACCACTCTCATG|GAAGCAAAGCCCGTTCAAATTGACGAATGGTCTAATGGTAAAGCTTTGATGGCAACTGGTTCTCCACTTCCTCCTCTCACACGTAATGGTAAAGAATATGTGATTTCTCAATGCAATAATGCTCTTCTTTACCCTGCTCTAGGTGTTGCATGTGTGTTATCCCGTTGCAAATTGTTGAGC|GATGGAATGCTGAAAGCAGCTTCCGATGCTTTGGCCACTGTTCCTAGATCTTTGTTTGTCGCCGATGAAGCTCTCTTGCCAGATCTGGACAATGCTCGAGAAATCTCTCGTCACATCGTTTTTGCGGTTTTGAAGCAAGCCATTTCTGAAGGAATGAGCACAGTGGATTTACCCAAAGATGATGCCAAGTTGAAGGAATGGATTATTGAACGAGAATGGAACCCTGAATACAGGAATTTTGTA

# this is its transaltion (exons separated by "|")
MTLCAGFDPNRFLPIVLDVGTNNETHRKNHQYMGLRKDRVHGEQYDIFLENVIKAIREVFPEAFIHFEDFGLKNAKRILDHYRPNIACFNDDIQGTGAVALAAIIGALHV|TKSPLTEQRIMIFGAGTAGVGIANQIVAGMVTDGLSLGKARDNLFMIDRCGLLLERHAKIATDGQKPFLKKDSDFKEVPSGDIDLETAISLIKPTVLLGCSGQPGKFTEKAIREMSKHVKHPIIFPISNPTTLM|EAKPVQIDEWSNGKALMATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLS|DGMLKAASDALATVPRSLFVADEALLPDLDNAREISRHIVFAVLKQAISEGMSTVDLPKDDAKLKEWIIEREWNPEYRNFV


# the following is an embedding of the 4 exons in non-coding segments (lower case):
# intron generation: paste(sample(c("a","c","g","t"), 100, replace = TRUE), collapse = "")
# intron generation: paste(sample(c("a","c","g","t"), 50, replace = TRUE), collapse = "")
# intron generation: paste(sample(c("a","c","g","t"), 80, replace = TRUE), collapse = "")
# intron generation: paste(sample(c("a","c","g","t"), 60, replace = TRUE), collapse = "")
# intron generation: paste(sample(c("a","c","g","t"), 90, replace = TRUE), collapse = "")
tcgtggagcgccgaggcgaaggatctgaggtcaccggcgctagaccgtctccgaccgtacattggagcacgacatgacctaagttcgtgataaatccaacATGACTTTATGCGCAGGTTTTGACCCTAATCGATTTTTGCCCATCGTTCTCGACGTTGGCACCAACAATGAAACCCATCGTAAAAATCATCAATACATGGGTTTAAGAAAGGACCGTGTTCACGGTGAGCAGTATGACATCTTTTTGGAGAACGTTATTAAAGCCATTCGTGAAGTCTTTCCCGAGGCCTTTATTCACTTTGAGGATTTCGGACTTAAAAATGCCAAAAGGATTTTAGACCACTATCGTCCTAATATTGCCTGTTTTAACGATGATATCCAGGGCACCGGTGCTGTAGCACTGGCCGCCATTATAGGCGCCCTTCATGTTtatcctcctgaactagcacatgtaattctgggtcgttactagggtaatctACGAAGTCTCCCTTAACCGAGCAGCGCATCATGATCTTTGGTGCTGGTACTGCTGGTGTTGGTATCGCCAACCAAATTGTCGCTGGTATGGTGACAGATGGCCTTTCATTAGGTAAGGCTAGAGATAATCTTTTCATGATTGATCGATGCGGTTTGCTTCTGGAGAGACATGCTAAGATTGCTACTGATGGACAAAAGCCATTTTTGAAGAAGGACTCAGACTTTAAGGAAGTCCCTTCTGGAGACATTGATTTAGAGACTGCTATTTCACTAATCAAACCCACTGTTCTTCTGGGGTGCTCCGGTCAACCTGGAAAATTTACAGAAAAGGCCATTCGTGAAATGAGCAAGCATGTCAAACATCCCATCATCTTCCCAATCTCTAACCCCACCACTCTCATGctttgattagtttttacggcttctgttccacggttcgacccggcgagctttactggcaacgtatacacccccctcgtaccGAAGCAAAGCCCGTTCAAATTGACGAATGGTCTAATGGTAAAGCTTTGATGGCAACTGGTTCTCCACTTCCTCCTCTCACACGTAATGGTAAAGAATATGTGATTTCTCAATGCAATAATGCTCTTCTTTACCCTGCTCTAGGTGTTGCATGTGTGTTATCCCGTTGCAAATTGTTGAGCggtttctgagcccctgccgatagagaccactgagatggtgatctcggaaacaacgaatacGATGGAATGCTGAAAGCAGCTTCCGATGCTTTGGCCACTGTTCCTAGATCTTTGTTTGTCGCCGATGAAGCTCTCTTGCCAGATCTGGACAATGCTCGAGAAATCTCTCGTCACATCGTTTTTGCGGTTTTGAAGCAAGCCATTTCTGAAGGAATGAGCACAGTGGATTTACCCAAAGATGATGCCAAGTTGAAGGAATGGATTATTGAACGAGAATGGAACCCTGAATACAGGAATTTTGTAgtaggctgccccatctcttaggtatgtaaagccgccaaattaacggtccagaacgagctgtgggatggttcgtagtggcagatgaacggg


# the following adds exon2 at the end (non optimal match, should not be recovered):
>my_multi_exon_contig
tcgtggagcgccgaggcgaaggatctgaggtcaccggcgctagaccgtctccgaccgtacattggagcacgacatgacctaagttcgtgataaatccaacATGACTTTATGCGCAGGTTTTGACCCTAATCGATTTTTGCCCATCGTTCTCGACGTTGGCACCAACAATGAAACCCATCGTAAAAATCATCAATACATGGGTTTAAGAAAGGACCGTGTTCACGGTGAGCAGTATGACATCTTTTTGGAGAACGTTATTAAAGCCATTCGTGAAGTCTTTCCCGAGGCCTTTATTCACTTTGAGGATTTCGGACTTAAAAATGCCAAAAGGATTTTAGACCACTATCGTCCTAATATTGCCTGTTTTAACGATGATATCCAGGGCACCGGTGCTGTAGCACTGGCCGCCATTATAGGCGCCCTTCATGTTtatcctcctgaactagcacatgtaattctgggtcgttactagggtaatctACGAAGTCTCCCTTAACCGAGCAGCGCATCATGATCTTTGGTGCTGGTACTGCTGGTGTTGGTATCGCCAACCAAATTGTCGCTGGTATGGTGACAGATGGCCTTTCATTAGGTAAGGCTAGAGATAATCTTTTCATGATTGATCGATGCGGTTTGCTTCTGGAGAGACATGCTAAGATTGCTACTGATGGACAAAAGCCATTTTTGAAGAAGGACTCAGACTTTAAGGAAGTCCCTTCTGGAGACATTGATTTAGAGACTGCTATTTCACTAATCAAACCCACTGTTCTTCTGGGGTGCTCCGGTCAACCTGGAAAATTTACAGAAAAGGCCATTCGTGAAATGAGCAAGCATGTCAAACATCCCATCATCTTCCCAATCTCTAACCCCACCACTCTCATGctttgattagtttttacggcttctgttccacggttcgacccggcgagctttactggcaacgtatacacccccctcgtaccGAAGCAAAGCCCGTTCAAATTGACGAATGGTCTAATGGTAAAGCTTTGATGGCAACTGGTTCTCCACTTCCTCCTCTCACACGTAATGGTAAAGAATATGTGATTTCTCAATGCAATAATGCTCTTCTTTACCCTGCTCTAGGTGTTGCATGTGTGTTATCCCGTTGCAAATTGTTGAGCggtttctgagcccctgccgatagagaccactgagatggtgatctcggaaacaacgaatacGATGGAATGCTGAAAGCAGCTTCCGATGCTTTGGCCACTGTTCCTAGATCTTTGTTTGTCGCCGATGAAGCTCTCTTGCCAGATCTGGACAATGCTCGAGAAATCTCTCGTCACATCGTTTTTGCGGTTTTGAAGCAAGCCATTTCTGAAGGAATGAGCACAGTGGATTTACCCAAAGATGATGCCAAGTTGAAGGAATGGATTATTGAACGAGAATGGAACCCTGAATACAGGAATTTTGTAgtaggctgccccatctcttaggtatgtaaagccgccaaattaacggtccagaacgagctgtgggatggttcgtagtggcagatgaacgggACGAAGTCTCCCTTAACCGAGCAGCGCATCATGATCTTTGGTGCTGGTACTGCTGGTGTTGGTATCGCCAACCAAATTGTCGCTGGTATGGTGACAGATGGCCTTTCATTAGGTAAGGCTAGAGATAATCTTTTCATGATTGATCGATGCGGTTTGCTTCTGGAGAGACATGCTAAGATTGCTACTGATGGACAAAAGCCATTTTTGAAGAAGGACTCAGACTTTAAGGAAGTCCCTTCTGGAGACATTGATTTAGAGACTGCTATTTCACTAATCAAACCCACTGTTCTTCTGGGGTGCTCCGGTCAACCTGGAAAATTTACAGAAAAGGCCATTCGTGAAATGAGCAAGCATGTCAAACATCCCATCATCTTCCCAATCTCTAACCCCACCACTCTCATG

# our multi-exon protein is in (count from 0): [100-429];[480-881];[962-1141];[1202-1444]
# these coordinates are expected to *roughly* be recovered by metaeuk
# two amino acids are missed at the start of the 3rd exon.
# it is okay! reasons for disagreements in coordinates:
# (1) first/last AA of an exon might not be translated
# (2) two exons might overlap on the target - this happens here between the 2nd and 3rd exons:
# 2nd exon matches these coordinates on the target: 110	243
# 3rd exon matches these coordinates on the target: 236	303
# therefore a little less is taken from the 3rd exon when joining the protein.
# specifically, 8 amino acids are not taken from the 3rd exon but since this part of the local
# alignment has gaps, we miss two amino acids. This is the MMseqs2 alignment of the 3rd exon:
# ISNPTTLMEAKPVQIDEWSNGKALMATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLS
# IHPPRT--EAKPVQIDEWSNGKALMATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLS
# when removing 8 amino acids from the 3rd exon we get:
# KPVQIDEWSNGKALMATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLS
# this losing EA.

# now create a DB of three proteins (almost identical) - this will cause multiple reports of the protein:
>identical_all_4_exons
MTLCAGFDPNRFLPIVLDVGTNNETHRKNHQYMGLRKDRVHGEQYDIFLENVIKAIREVFPEAFIHFEDFGLKNAKRILDHYRPNIACFNDDIQGTGAVALAAIIGALHVTKSPLTEQRIMIFGAGTAGVGIANQIVAGMVTDGLSLGKARDNLFMIDRCGLLLERHAKIATDGQKPFLKKDSDFKEVPSGDIDLETAISLIKPTVLLGCSGQPGKFTEKAIREMSKHVKHPIIFPISNPTTLMEAKPVQIDEWSNGKALMATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLSDGMLKAASDALATVPRSLFVADEALLPDLDNAREISRHIVFAVLKQAISEGMSTVDLPKDDAKLKEWIIEREWNPEYRNFV
>identical_exon1_and_exon4
MTLCAGFDPNRFLPIVLDVGTNNETHRKNHQYMGLRKDRVHGEQYDIFLENVIKAIREVFPEAFIHFEDFGLKNAKRILDHYRPNIACFNDDIQGTGAVALAAIIGALHVDGMLKAASDALATVPRSLFVADEALLPDLDNAREISRHIVFAVLKQAISEGMSTVDLPKDDAKLKEWIIEREWNPEYRNFV
>similar_but_shorter_all_4_exons
MTLCAGFDPNRFLPIVLDVGTNNETHRKNHQYMGLRKDGEQYDIFLENVIKAIREVFPEAFIHFEDFGLKNAKRILDHYRPNIACFNDDIQGTGAVALAAIIGALHVTKSPLTEQRIMIFGAGTAGVGIANQIMVTDGLSLGKARDNLFMIDRCGLLLERHAKIATDGQKPFLKKDSDFKEVPSGDIDLETAISLIKPTVLLGCSGQPGKFTEKAIREMSKHVKHPIIFPISNPTTLMEAKPVQIDEWSNGKATGSPLPPLTRNGKEYVISQCNNALLYPALGVACVLSRCKLLSDGMLKAASDALATVPRSLFVADEALLPDLDNAREISRHIVFAVLKQAISEGMSTVDLPKDDAKLKEWIIEREWNPEYR
